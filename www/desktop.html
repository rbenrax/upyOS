<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>upyOS Desktop</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
    <div id="app">
        <header class="top-bar">
            <button class="menu-toggle" id="menu-toggle">☰</button>
            <div class="logo">upyOS Desktop</div>
            <div class="status-bar">
                <span id="connection-status" class="status-indicator">Connected</span>
            </div>
        </header>

        <div class="main-container">
            <aside class="sidebar" id="sidebar">
                <nav>
                    <button class="nav-btn active" data-view="status">Status</button>
                    <button class="nav-btn" data-view="files">Files</button>
                    <button class="nav-btn" data-view="gpio">GPIO</button>
                    <button class="nav-btn" data-view="terminal">Terminal (Beta)</button>
                    <button class="nav-btn" data-view="run">Run</button>
                    <button class="nav-btn" data-view="about">About</button>
                    <div class="nav-spacer"></div>
                    <button class="nav-btn logout-btn" id="btn-logout">Logout</button>
                </nav>
            </aside>
            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <main class="content-area">
                <!-- File Manager View -->
                <div id="view-files" class="view-section">
                    <div class="toolbar">
                        <button id="btn-refresh">Refresh</button>
                        <button id="btn-up">Up</button>
                        <span id="current-path">/</span>
                        <div class="spacer"></div>
                        <button id="btn-mkdir">New Folder</button>
                        <button id="btn-newfile">New File</button>
                        <button id="btn-upload">Upload</button>
                        <input type="file" id="file-input" style="display: none;">
                    </div>
                    <div class="file-browser" id="file-list">
                        <!-- File items will be injected here -->
                    </div>

                    <!-- Code Editor Overlay -->
                    <div id="editor-overlay" class="hidden">
                        <div class="editor-toolbar">
                            <span id="editor-filename">filename.py</span>
                            <div class="spacer"></div>
                            <button id="btn-save">Save</button>
                            <button id="btn-close-editor">Close</button>
                        </div>
                        <div class="editor-wrapper">
                            <pre id="highlight-layer" aria-hidden="true"></pre>
                            <textarea id="code-editor" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>

                <!-- GPIO View -->
                <div id="view-gpio" class="view-section">
                    <div class="toolbar">
                        <h2>GPIO Dashboard</h2>
                        <button id="btn-refresh-gpio">Refresh</button>
                    </div>
                    <div class="gpio-grid" id="gpio-list">
                        <!-- GPIO items -->
                    </div>
                </div>

                <!-- Status View -->
                <div id="view-status" class="view-section active">
                    <div class="toolbar">
                        <h2>System Status</h2>
                        <button id="btn-refresh-status" style="margin-right: 10px;">Refresh</button>
                        <button id="btn-reset-mcu">Reset MCU</button>
                    </div>
                    <div class="status-content" id="status-container">
                        <!-- injected via JS -->
                    </div>
                </div>

                <!-- Terminal View -->
                <div id="view-terminal" class="view-section">
                    <div class="toolbar">
                        <h2>Terminal (Beta)</h2>
                        <span id="term-status"
                            style="font-size: 0.8rem; color: var(--text-secondary); margin-left: auto; margin-right: 10px;">Disconnected</span>
                        <button id="btn-term-connect">Connect</button>
                    </div>
                    <div style="padding: 20px; height: calc(100% - 60px); position: relative;">
                        <div id="terminal-container" style="
                            background: #000; 
                            color: #0f0; 
                            font-family: 'Courier New', monospace; 
                            width: 100%; 
                            height: 100%; 
                            padding: 10px; 
                            border-radius: 4px; 
                            overflow-y: auto; 
                            white-space: pre-wrap; 
                            border: 1px solid var(--border-color);
                            cursor: text;
                         "></div>
                        <!-- Hidden input to capture mobile/hidden keyboard input -->
                        <input type="text" id="term-input-proxy"
                            style="opacity: 0; position: absolute; top: 0; left: 0; height: 0; width: 0;"
                            autocomplete="off" autocapitalize="off" spellcheck="false">
                    </div>
                </div>

                <!-- Run View -->
                <div id="view-run" class="view-section">
                    <div class="toolbar">
                        <h2>Run Command</h2>
                        <span
                            style="font-size: 0.8rem; color: var(--text-secondary); margin-left: auto; text-align: right;">
                            ⚠️ Not a full terminal. Some commands may fail or hang, requiring an MCU reset. <br>
                            Interactive commands (input) are disabled. Use <strong>utelnetd</strong> for full shell.
                        </span>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                            <input type="text" id="cmd-input" placeholder="Enter command" autocapitalize="none"
                                autocorrect="off" spellcheck="false"
                                style="flex: 1; padding: 10px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--header-bg); color: white;">
                            <button id="btn-run-cmd">Execute</button>
                            <button id="btn-stop-cmd">Stop</button>
                            <button id="btn-clear-output">Clear</button>
                        </div>
                        <div id="cmd-output"
                            style="background: #111; color: #0f0; padding: 15px; border-radius: 4px; font-family: monospace; height: 400px; overflow-y: auto; white-space: pre-wrap;">
                        </div>
                    </div>
                </div>

                <!-- About View -->
                <div id="view-about" class="view-section">
                    <div class="about-content">
                        <h1>upyOS Desktop v0.3</h1>
                        <p>Web-based Operating Environment for MicroPython.</p>
                        <p>Running on upyOS.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="app.js"></script>
</body>

</html>